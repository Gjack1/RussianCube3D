<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>3D俄罗斯方块</title>
	<script src="./three.js"></script>
	<script src="./cellCube.js"></script>
	<script src="./RussianCube.js"></script>
</head>
<body>
	<script>
		// 创建场景
		var scene = new THREE.Scene()

		// 创建相机
		var camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000)
		camera.position.set(60,60,60)
		camera.lookAt(new THREE.Vector3(0,0,0))

		// 创建容器
		var oCantainerGeo = new THREE.CubeGeometry(11,41,11)
		var oCantainerMat = new THREE.MeshLambertMaterial({color:0xeeeeee,transparent:true,opacity:0.05})
		var oCantainer = new THREE.Mesh(oCantainerGeo,oCantainerMat)
		oCantainer.position.set(5.5,20.5,5.5)
		var newoCan = oCantainer.clone();

		// 创建俄罗斯方块
		var cube = new RussianCube()
		oCantainer.add(cube)
		// 定时器轮询前一个俄罗斯方块是否落定,落定则加载下一个
		setInterval(function(){
			if(!cube.moving){
				
				cube = new RussianCube()
				oCantainer.add(cube)
			}
		},1000)


		// 转动容器
		document.onmousedown = function(){
			document.onmousemove = function(e){
				oCantainer.rotation.y = e.clientX/100
				newoCan.rotation.y = e.clientX/100
			}
			document.onmouseup = function(){
				document.onmousemove = null
			}
		}
		document.onkeydown = function(e){
			cube.moveCtrl(e)
		}

		// 创建光源
		var light = new THREE.DirectionalLight()
		light.position.set(3,2,1)

		// 坐标助手
		var axis = new THREE.AxisHelper(200)
		scene.add(camera,oCantainer,newoCan,light,axis)

		// 创建渲染器
		var renderer = new THREE.WebGLRenderer()
		renderer.setSize(window.innerWidth, window.innerHeight)
		window.onresize=function(){
			renderer.setSize(window.innerWidth, window.innerHeight)
		}

		// 渲染
		document.body.append(renderer.domElement)
		function render(){
			renderer.render(scene,camera)
			requestAnimationFrame(render)
		}
		render()
		
	</script>
</body>
</html>