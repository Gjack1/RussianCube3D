<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>3D俄罗斯方块</title>
	<script src="./three.js"></script>
	<script src="./cellCube.js"></script>
	<script src="./RussianCube.js"></script>
	<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
</head>
<body>
	<script>
		// 创建场景
		var scene = new THREE.Scene()
		// scene.setClearColor=0xffffff
		// 创建相机
		var camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000)
		camera.position.set(15,35,15)
		camera.lookAt(new THREE.Vector3(0,10,0))

		// 创建容器
		var oCantainerGeo = new THREE.CubeGeometry(7,21,7)
		var oCantainerMat = new THREE.MeshLambertMaterial({color:0xeeeeee,transparent:true,opacity:0.05})
		var oCantainer = new THREE.Mesh(oCantainerGeo,oCantainerMat)
		oCantainer.position.set(5.5,20.5,5.5)
		// 克隆容器，用来装castShape
		var newoCan = oCantainer.clone();

		// 创建俄罗斯方块
		var russianCube = new RussianCube()
		oCantainer.add(russianCube)
		// 定时器轮询前一个俄罗斯方块是否落定,落定则加载下一个
		setInterval(function(){
			if(!russianCube.moving){
				russianCube = new RussianCube()
				oCantainer.add(russianCube)
			}
		},1000)

		// 分数
		var score = 0
		var pause = false
		var castShape = false

		// 转动容器
		document.onmousedown = function(e){
			var startX=0;
			document.onmousemove = function(e){
				if(e.clientX-startX>0){
					oCantainer.rotation.y += 0.08
					newoCan.rotation.y += 0.08	
				}else if(e.clientX-startX<0){
					oCantainer.rotation.y -= 0.08
					newoCan.rotation.y -= 0.08
				}
				startX = e.clientX
			}
			document.onmouseup = function(){

				document.onmousemove = null
			}
		}

		document.onkeydown = function(e){
			russianCube.moveCtrl(e)
		}

		// 创建光源
		var light = new THREE.DirectionalLight()
		light.position.set(3,2,1)

		// 坐标助手
		// var axis = new THREE.AxisHelper(200)
		scene.add(camera,oCantainer,newoCan,light)

		// 创建渲染器
		var renderer = new THREE.WebGLRenderer()
		renderer.setSize(window.innerWidth, window.innerWidth)
		renderer.setClearColor(0x33a3dc,0.5);  

		// 渲染
		document.body.append(renderer.domElement)

		function render(){
				requestAnimationFrame(render)
				renderer.render(scene,camera)

		}
		render()
		
	</script>
</body>
</html>